{% load extra_filters %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人设置</title>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>

<body>
    <nav class="navbar navbar-inverse" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">毕业设计管理系统</a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">
                    <li><a href="#">我的任务</a></li>
                    <li><a href="#">选择课题</a></li>
                    <li><a href="#">毕业设计过程</a></li>
                    <li><a href="#">公告</a></li>
                    <li><a href="#">下载中心</a></li>
                    <li class="active"><a href="/user/student_settings/">个人设置</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="/logout/">退出</a></li>
                </ul>
                <div class="navbar-right">
                    <p class="navbar-text">{{ user | get_username }}</p>
                </div>
            </div>

        </div>
    </nav>
    <div class="container" id="app">
        <div class="page-header">
            <h3>个人设置 <small>基本信息</small></h3>
        </div>

        <form class="form-inline" role="form">
            {% csrf_token %}
            <div class="form-group">
                <label class="" for="username">学号</label>
                <input type="text" id="username" class="form-control" readonly="readonly" value="{{ student.username }}">
            </div>
            <div class="form-group" style="width: 100px;"></div>
            <div class="form-group">
                <label class="" for="name">姓名</label>
                <input type="text" id="name" class="form-control" placeholder="请输入姓名" readonly="readonly" value="{{ student.name }}">
            </div>
            <div style="height: 10px;"></div>
            <div class="form-group">
                <label class="" for="phone">手机</label>
                <input type="text" id="phone" class="form-control" placeholder="请输入手机号" value="{{ student.phone }}">
            </div>
            <div class="form-group" style="width: 100px;"></div>
            <div class="form-group">
                <label class="" for="gender">性别</label>
                <select name="gender" id="gender" class="form-control">
                    <option value="0" {% if student.gender == "0" %} selected {% endif %}>男</option>
                    <option value="1" {% if student.gender == "1" %} selected {% endif %}>女</option>
                </select>
            </div>
            <div style="height: 10px;"></div>
            <div class="form-group">
                <label class="" for="qq" style="width: 28px;">QQ </label>
                <input type="text" id="qq" class="form-control" placeholder="请输入QQ号" value="{{ student.qq }}">
            </div>
            <div class="form-group" style="width: 100px;"></div>
            <div class="form-group">
                <label class="" for="email">邮箱</label>
                <input type="text" id="email" class="form-control" placeholder="请输入邮箱" value="{{ student.email }}">
            </div>
            <div style="height: 10px;"></div>
            <div class="form-group">
                <label class="" for="faculty">院系</label>
                <!-- <input type="text" id="faculty" class="form-control" placeholder="请输入名称" value="{{ student.faculty }}"> -->
                <select name="faculty" id="faculty" class="form-control" v-model="faculty_id">
                    <option v-for="faculty in facultyList" v-bind:value="faculty.id" v-text="faculty.name"></option>
                </select>
            </div>
            <div style="height: 10px;"></div>
            <div class="form-group">
                <label class="" for="profession">专业</label>
                <!-- <input type="text" id="profession" class="form-control" placeholder="请输入名称" value="{{ student.profession }}"> -->
                <select name="profession" id="profession" class="form-control" v-model="profession_id">
                    <option v-for="profess in professionList" v-bind:value="profess.id" v-text="profess.name"></option>
                </select>
            </div>
            <div style="height: 10px;"></div>
            <div class="form-group">
                <label class="" for="direction">方向</label>
                <!-- <input type="text" id="direction" class="form-control" placeholder="请输入名称" value="{{ student.direction }}"> -->
                <select name="direction" id="direction" class="form-control" v-model="direction_id">
                    <option v-for="direction in directionList" v-bind:value="direction.id" v-text="direction.name"></option>
                </select>
            </div>
            <div style="height: 10px;"></div>
            <div class="form-group">
                <label class="" for="klass">班级</label>
                <!-- <input type="text" id="klass" class="form-control" placeholder="请输入名称" value="{{ student.klass }}"> -->
                <select name="klass" id="klass" class="form-control" v-model="klass_id">
                    <option v-for="klass in klassList" v-bind:value="klass.id" v-text="klass.name"></option>
                </select>
            </div>
        </form>

        <div class="hidden_data">
            <!-- 隐藏数据 -->
            <input type="hidden" value="{{ student.faculty.id }}" id="faculty_id">
            <input type="hidden" value="{{ student.profession.id }}" id="profession_id">
            <input type="hidden" value="{{ student.direction.id }}" id="direction_id">
            <input type="hidden" value="{{ student.klass.id }}" id="klass_id">
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        var app = new Vue({
            el: "#app",
            data: {
                facultyList: [{id:1, name:"111"}],
                professionList: [],
                directionList: [],
                klassList: [],
                baseUrl: "http://127.0.0.1:8000/organization/",
                faculty_id: 0,
                profession_id: 0,
                direction_id: 0,
                klass_id: 0
            },
            methods: {
                get_faculty(){
                    /* 获取所有的学院 */
                    var url = this.baseUrl + "facultys/"
                    axios.get(url)
                    .then(function(res){
                        console.log(res);
                        app.facultyList = res.data
                        return this.facultyList
                    })
                    .catch(function(error) {
                        console.log(error)
                    })
                },

                get_profession(faculty_id){
                    /* 获取指定学院的所有专业
                        faculty_id: 学院id
                     */
                    var url = this.baseUrl + "professions/" + "?faculty_id=" + faculty_id
                    axios.get(url)
                    .then(function(res){
                        console.log(res)
                        app.professionList = res.data
                    })
                    .catch(function(error){
                        console.log(error)
                    })
                },

                get_direction(profession_id){
                    /* 获取对应专业的所有方向
                        profession_id: 专业id
                     */
                    var url = this.baseUrl + "directions/" + "?profession_id=" + profession_id
                    axios.get(url)
                    .then(function(res){
                        console.log(res)
                        app.directionList = res.data
                    })
                },

                get_klass(direction_id){
                    /* 获取指定方向的所有班级
                        direction_id: 方向id
                     */
                    var url = this.baseUrl + "klasses/" + "?direction_id=" + direction_id
                    axios.get(url)
                    .then(function(res){
                        console.log(res)
                        app.klassList = res.data
                    })
                },

                get_need_data(){
                    /* 获取一些需要使用的数据 */
                    this.faculty_id = parseInt(document.getElementById('faculty_id').value)
                    this.profession_id = parseInt(document.getElementById('profession_id').value)
                    this.direction_id = parseInt(document.getElementById('direction_id').value)
                    this.klass_id = parseInt(document.getElementById('klass_id').value)
                }
            },
            watch: {
                /* 监视data中数据的改变触发相应事件 */
                faculty_id(newVal, oldVal){
                    this.get_profession(newVal)
                },
                profession_id(newVal, oldVal){
                    this.get_direction(newVal)
                },
                direction_id(newVal, oldVal){
                    this.get_klass(newVal)
                }
            },
            mounted() {
                /* 实例挂载后调用指定方法获取数据 */
                this.get_faculty()
                this.get_need_data()
            },
            
        })
    </script>
</body>
    
</html>